/**
 * ‚úÖ textTokenize.js
 * - tokenizeText: ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏ä‡∏¥‡πâ‡∏ô‚Äù ‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ (token)
 * - normalizeToken: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ token ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠ match ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
 */

/**
 * ‚úÖ tokenizeText(text)
 * - ‡πÅ‡∏¢‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
 * - ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥/‡πÄ‡∏•‡∏Ç/‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡∏û‡∏≠‡πÄ‡∏´‡∏°‡∏≤‡∏∞ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå)
 */
export function tokenizeText(text) {
  // ‚úÖ ‡πÅ‡∏¢‡∏Å‡πÇ‡∏î‡∏¢‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏ß‡∏¢ (‡πÄ‡∏û‡∏∑‡πà‡∏≠ render ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô)
  const parts = String(text).split(/(\s+)/g);

  const tokens = [];

  parts.forEach((part) => {
    // ‚úÖ ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á/‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î -> ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å
    if (part.trim() === "") {
      tokens.push({ text: part, clickable: false });
      return;
    }

    // ‚úÖ match ‡∏Ñ‡∏≥‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ - / : .
    // ‡πÄ‡∏ä‡πà‡∏ô 089-123-4567, 09:00-12:00, 3/2, 1-2345-67890-12-3
    const matches = part.match(/[‡∏Å-‡πôA-Za-z0-9]+(?:[-/:.][A-Za-z0-9]+)*/g);

    // ‚úÖ ‡∏ñ‡πâ‡∏≤ match ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥) ‡∏Å‡πá‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πâ‡∏≠‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ
    if (!matches) {
      tokens.push({ text: part, clickable: true });
      return;
    }

    // ‚úÖ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢/‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥‡∏´‡∏≤‡∏¢ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ cursor
    let cursor = 0;

    matches.forEach((m) => {
      const idx = part.indexOf(m, cursor);

      // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô "‚Äú" ‡∏´‡∏£‡∏∑‡∏≠ "üéâ")
      if (idx > cursor) {
        tokens.push({ text: part.slice(cursor, idx), clickable: true });
      }

      // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö token ‡∏ó‡∏µ‡πà match
      tokens.push({ text: m, clickable: true });

      cursor = idx + m.length;
    });

    // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢
    if (cursor < part.length) {
      tokens.push({ text: part.slice(cursor), clickable: true });
    }
  });

  return tokens;
}

/**
 * ‚úÖ normalizeToken(token)
 * - lower-case
 * - trim
 * - ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞: ‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞ - / : .
 */
export function normalizeToken(token) {
  if (!token) return "";

  const lower = String(token).toLowerCase().trim();

  // ‚úÖ ‡∏ï‡∏±‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Å‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥
  return lower.replace(/[^‡∏Å-‡πôa-z0-9\-\/:\.]+/g, "");
}
